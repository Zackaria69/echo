<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Sky Simulation</title>
    <style>
        :root {
            --sky-top: #1a2a5a;
            --sky-middle: #4b8ddf;
            --sky-bottom: #a7c8f2;
            --sun-color: #ffde00;
            --sun-glow: #ff8c00;
            --moon-color: #e0e0e0;
            --moon-glow: #a0a0a0;
            --time-of-day: 0.5;
            --celestial-body-opacity: 1;
        }

        body {
            margin: 0;
            overflow: hidden;
            height: 100vh;
            font-family: Arial, sans-serif;
            transition: background 2s ease;
        }

        .sky-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .sky-gradient {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                var(--sky-top) 0%,
                var(--sky-middle) 50%,
                var(--sky-bottom) 100%
            );
            transition: background 2s ease;
        }

        .celestial-body {
            position: absolute;
            width: 6vmin;
            height: 6vmin;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            transition: all 1s ease;
            opacity: var(--celestial-body-opacity);
        }

        .sun {
            background: radial-gradient(
                circle at 30% 30%,
                white 0%,
                var(--sun-color) 40%,
                var(--sun-glow) 100%
            );
            filter: blur(1px);
            box-shadow: 
                0 0 5vmin 2vmin rgba(255, 222, 0, 0.4),
                0 0 10vmin 5vmin rgba(255, 140, 0, 0.3);
        }

        .moon {
            background: radial-gradient(
                circle at 70% 30%,
                white 0%,
                var(--moon-color) 40%,
                var(--moon-glow) 100%
            );
            filter: blur(0.5px);
            box-shadow: 
                0 0 3vmin 1vmin rgba(224, 224, 224, 0.2),
                0 0 5vmin 2vmin rgba(160, 160, 160, 0.1);
        }

        .celestial-rays {
            position: absolute;
            width: 20vmin;
            height: 20vmin;
            border-radius: 50%;
            animation: pulse 8s infinite alternate;
            transform: translate(-50%, -50%);
            z-index: 9;
            transition: all 1s ease;
        }

        .sun-rays {
            background: radial-gradient(
                circle,
                rgba(255, 222, 0, 0.2) 0%,
                rgba(255, 222, 0, 0) 70%
            );
        }

        .moon-rays {
            background: radial-gradient(
                circle,
                rgba(224, 224, 224, 0.1) 0%,
                rgba(224, 224, 224, 0) 70%
            );
        }

        .lens-flare {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            filter: blur(5px);
            z-index: 11;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .cloud-layer {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .cloud {
            position: absolute;
            background: white;
            border-radius: 50%;
            filter: blur(8px);
            opacity: 0.9;
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 2s ease;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 5s infinite alternate;
        }

        .atmospheric-haze {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 40%;
            background: linear-gradient(
                to top,
                rgba(255, 255, 255, 0.3) 0%,
                transparent 100%
            );
            z-index: 5;
        }

        .controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            color: white;
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
            100% { transform: translate(-50%, -50%) scale(1.3); opacity: 0.8; }
        }

        @keyframes twinkle {
            0% { opacity: 0.2; }
            100% { opacity: 1; }
        }

        @keyframes moveSlow {
            0% { transform: translateX(-10%) }
            100% { transform: translateX(110%) }
        }

        @keyframes moveMedium {
            0% { transform: translateX(-20%) }
            100% { transform: translateX(120%) }
        }

        @keyframes moveFast {
            0% { transform: translateX(-30%) }
            100% { transform: translateX(130%) }
        }
    </style>
</head>
<body>
    <div class="sky-container">
        <div class="sky-gradient"></div>
        <div class="celestial-rays sun-rays"></div>
        <div class="celestial-body sun"></div>
        <div class="celestial-body moon"></div>
        <div class="celestial-rays moon-rays"></div>
        <div class="lens-flare" id="lens-flare-1"></div>
        <div class="lens-flare" id="lens-flare-2"></div>
        <div class="lens-flare" id="lens-flare-3"></div>
        
        <div class="stars" id="stars"></div>
        
        <!-- Cloud layers with different speeds for parallax -->
        <div class="cloud-layer" id="high-clouds"></div>
        <div class="cloud-layer" id="medium-clouds"></div>
        <div class="cloud-layer" id="low-clouds"></div>
        
        <div class="atmospheric-haze"></div>
    </div>

    <div class="controls">
        <label>Time of Day: <input type="range" id="time-slider" min="0" max="1" step="0.01" value="0.5"></label><br>
        <label>Cloud Cover: <input type="range" id="cloud-slider" min="0" max="1" step="0.1" value="0.5"></label>
    </div>

    <script>
        // Configuration
        const config = {
            cloudDensity: 0.5,
            timeOfDay: 0.5,
            windSpeed: 1,
            cloudTypes: {
                cirrus: { size: [100, 300], opacity: 0.6, blur: 10, yRange: [0.1, 0.3], speed: 0.2 },
                cumulus: { size: [150, 400], opacity: 0.9, blur: 8, yRange: [0.2, 0.5], speed: 0.5 },
                stratus: { size: [300, 600], opacity: 0.7, blur: 15, yRange: [0.4, 0.7], speed: 0.3 }
            }
        };

        // DOM Elements
        const sun = document.querySelector('.sun');
        const moon = document.querySelector('.moon');
        const sunRays = document.querySelector('.sun-rays');
        const moonRays = document.querySelector('.moon-rays');
        const skyGradient = document.querySelector('.sky-gradient');
        const highClouds = document.getElementById('high-clouds');
        const mediumClouds = document.getElementById('medium-clouds');
        const lowClouds = document.getElementById('low-clouds');
        const stars = document.getElementById('stars');
        const timeSlider = document.getElementById('time-slider');
        const cloudSlider = document.getElementById('cloud-slider');
        const lensFlares = [
            document.getElementById('lens-flare-1'),
            document.getElementById('lens-flare-2'),
            document.getElementById('lens-flare-3')
        ];

        // Time of day colors
        const timeColors = [
            // Night (0-0.25)
            { top: '#0a0e23', middle: '#1a2a5a', bottom: '#2a3a6b', sun: '#ff9d00', glow: '#ff5a00', celestialOpacity: 0 },
            // Dawn (0.25-0.35)
            { top: '#1a1a3a', middle: '#3a5a8a', bottom: '#5a8aab', sun: '#ff9d00', glow: '#ff5a00', celestialOpacity: 1 },
            // Day (0.35-0.65)
            { top: '#1a2a5a', middle: '#4b8ddf', bottom: '#a7c8f2', sun: '#ffde00', glow: '#ff8c00', celestialOpacity: 1 },
            // Dusk (0.65-0.75)
            { top: '#1a1a3a', middle: '#8a5a5a', bottom: '#ab8a5a', sun: '#ff5a00', glow: '#ff2a00', celestialOpacity: 1 },
            // Night (0.75-1)
            { top: '#0a0e23', middle: '#1a2a5a', bottom: '#2a3a6b', sun: '#ff9d00', glow: '#ff5a00', celestialOpacity: 0 }
        ];

        // Initialize
        function init() {
            generateClouds();
            generateStars();
            updateSky();
            setupEventListeners();
            animate();
        }

        // Generate realistic clouds
        function generateClouds() {
            clearClouds();
            
            // Create different cloud types in different layers
            createClouds(highClouds, 'cirrus', config.cloudDensity * 0.5);
            createClouds(mediumClouds, 'cumulus', config.cloudDensity);
            createClouds(lowClouds, 'stratus', config.cloudDensity * 0.7);
        }

        function generateStars() {
            stars.innerHTML = '';
            const starCount = 500;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                
                const size = randomBetween(0.5, 2);
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${randomBetween(0, 100)}%`;
                star.style.top = `${randomBetween(0, 70)}%`;
                star.style.opacity = randomBetween(0.2, 0.8);
                star.style.animationDelay = `${randomBetween(0, 5)}s`;
                
                stars.appendChild(star);
            }
        }

        function clearClouds() {
            highClouds.innerHTML = '';
            mediumClouds.innerHTML = '';
            lowClouds.innerHTML = '';
        }

        function createClouds(layer, type, density) {
            const cloudType = config.cloudTypes[type];
            const cloudCount = Math.floor(density * 10);
            
            for (let i = 0; i < cloudCount; i++) {
                const cloud = document.createElement('div');
                cloud.className = 'cloud';
                
                // Random cloud properties
                const width = randomBetween(...cloudType.size);
                const height = width * randomBetween(0.3, 0.6);
                const x = randomBetween(-20, 120);
                const y = randomBetween(...cloudType.yRange) * 100;
                const opacity = randomBetween(cloudType.opacity * 0.8, cloudType.opacity * 1.2);
                const blur = cloudType.blur;
                const speed = cloudType.speed * randomBetween(0.8, 1.2) * config.windSpeed;
                const delay = randomBetween(0, 60);
                
                // Apply styles
                cloud.style.width = `${width}px`;
                cloud.style.height = `${height}px`;
                cloud.style.left = `${x}%`;
                cloud.style.top = `${y}%`;
                cloud.style.opacity = opacity;
                cloud.style.filter = `blur(${blur}px)`;
                cloud.style.animation = `moveMedium ${100/speed}s linear ${delay}s infinite`;
                
                // Create cloud shape with multiple parts
                createCloudShape(cloud, width, height);
                
                layer.appendChild(cloud);
            }
        }

        function createCloudShape(container, width, height) {
            // Main cloud body
            container.style.borderRadius = `${height}px / ${width}px`;
            
            // Add cloud lumps
            const lumpCount = Math.floor(randomBetween(3, 6));
            for (let i = 0; i < lumpCount; i++) {
                const lump = document.createElement('div');
                lump.style.position = 'absolute';
                lump.style.background = 'white';
                lump.style.borderRadius = '50%';
                lump.style.filter = 'blur(5px)';
                
                const lumpSize = randomBetween(width * 0.3, width * 0.6);
                lump.style.width = `${lumpSize}px`;
                lump.style.height = `${lumpSize * randomBetween(0.6, 1)}px`;
                
                // Position lumps around the main cloud
                lump.style.left = `${randomBetween(-lumpSize/2, width - lumpSize/2)}px`;
                lump.style.top = `${randomBetween(-lumpSize/2, height - lumpSize/3)}px`;
                
                container.appendChild(lump);
            }
        }

        // Update sky based on time of day
        function updateSky() {
            // Determine which time segment we're in
            let segment;
            if (config.timeOfDay < 0.25) segment = 0; // Night
            else if (config.timeOfDay < 0.35) segment = 1; // Dawn
            else if (config.timeOfDay < 0.65) segment = 2; // Day
            else if (config.timeOfDay < 0.75) segment = 3; // Dusk
            else segment = 4; // Night
            
            // Calculate blend factor within segment
            let blend;
            if (segment === 0) blend = config.timeOfDay / 0.25;
            else if (segment === 1) blend = (config.timeOfDay - 0.25) / 0.1;
            else if (segment === 2) blend = (config.timeOfDay - 0.35) / 0.3;
            else if (segment === 3) blend = (config.timeOfDay - 0.65) / 0.1;
            else blend = (config.timeOfDay - 0.75) / 0.25;
            
            const from = timeColors[segment];
            const to = timeColors[segment + 1] || timeColors[segment];
            
            const topColor = interpolateColor(from.top, to.top, blend);
            const middleColor = interpolateColor(from.middle, to.middle, blend);
            const bottomColor = interpolateColor(from.bottom, to.bottom, blend);
            const sunColor = interpolateColor(from.sun, to.sun, blend);
            const sunGlow = interpolateColor(from.glow, to.glow, blend);
            const celestialOpacity = interpolateValue(from.celestialOpacity, to.celestialOpacity, blend);
            
            // Update CSS variables
            document.documentElement.style.setProperty('--sky-top', topColor);
            document.documentElement.style.setProperty('--sky-middle', middleColor);
            document.documentElement.style.setProperty('--sky-bottom', bottomColor);
            document.documentElement.style.setProperty('--sun-color', sunColor);
            document.documentElement.style.setProperty('--sun-glow', sunGlow);
            document.documentElement.style.setProperty('--celestial-body-opacity', celestialOpacity);
            
            // Position celestial bodies based on time of day
            const isDay = config.timeOfDay >= 0.35 && config.timeOfDay < 0.65;
            const bodyX = 0.2 + (config.timeOfDay * 0.6);
            
            // Sun follows a smooth arc but never goes all the way down
            let bodyY;
            if (config.timeOfDay < 0.35) {
                // Before day - sun rising
                bodyY = 0.1 + (config.timeOfDay / 0.35) * 0.8;
            } else if (config.timeOfDay < 0.65) {
                // Daytime - sun at top
                bodyY = 0.9 - ((config.timeOfDay - 0.35) / 0.3) * 0.8;
            } else {
                // After day - sun setting but not all the way
                bodyY = 0.1 + ((config.timeOfDay - 0.65) / 0.35) * 0.8;
            }
            
            // Moon follows opposite path
            const moonX = 1 - bodyX;
            const moonY = bodyY;
            
            sun.style.left = `${bodyX * 100}%`;
            sun.style.top = `${bodyY * 100}%`;
            sunRays.style.left = `${bodyX * 100}%`;
            sunRays.style.top = `${bodyY * 100}%`;
            
            moon.style.left = `${moonX * 100}%`;
            moon.style.top = `${moonY * 100}%`;
            moonRays.style.left = `${moonX * 100}%`;
            moonRays.style.top = `${moonY * 100}%`;
            
            // Adjust size based on position (larger near horizon)
            const bodySize = 6 + (Math.abs(0.5 - bodyY) * 4);
            sun.style.width = `${bodySize}vmin`;
            sun.style.height = `${bodySize}vmin`;
            moon.style.width = `${bodySize * 0.9}vmin`;
            moon.style.height = `${bodySize * 0.9}vmin`;
            
            // Show/hide stars
            stars.style.opacity = (config.timeOfDay < 0.35 || config.timeOfDay > 0.65) ? 1 : 0;
        }

        // Color interpolation helper
        function interpolateColor(color1, color2, factor) {
            if (factor <= 0) return color1;
            if (factor >= 1) return color2;
            
            const hex = color => {
                const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(color);
                return result ? [
                    parseInt(result[1], 16),
                    parseInt(result[2], 16),
                    parseInt(result[3], 16)
                ] : [0, 0, 0];
            };
            
            const rgb1 = hex(color1);
            const rgb2 = hex(color2);
            
            const r = Math.round(rgb1[0] + factor * (rgb2[0] - rgb1[0]));
            const g = Math.round(rgb1[1] + factor * (rgb2[1] - rgb1[1]));
            const b = Math.round(rgb1[2] + factor * (rgb2[2] - rgb1[2]));
            
            return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;
        }

        // Value interpolation helper
        function interpolateValue(val1, val2, factor) {
            return val1 + (val2 - val1) * factor;
        }

        // Lens flare effect
        function updateLensFlare(e) {
            const sunRect = sun.getBoundingClientRect();
            const sunX = sunRect.left + sunRect.width / 2;
            const sunY = sunRect.top + sunRect.height / 2;
            
            const mouseX = e.clientX;
            const mouseY = e.clientY;
            
            // Calculate angle between mouse and sun
            const dx = mouseX - sunX;
            const dy = mouseY - sunY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            // Only show lens flare when mouse is near sun and it's daytime
            const sunRadius = sunRect.width / 2;
            const showFlare = distance < 300 && config.timeOfDay >= 0.35 && config.timeOfDay < 0.65;
            
            if (showFlare) {
                // Position lens flare elements along the line from sun to mouse
                const angle = Math.atan2(dy, dx);
                
                lensFlares[0].style.width = '30px';
                lensFlares[0].style.height = '30px';
                lensFlares[0].style.left = `${sunX + Math.cos(angle) * 50}px`;
                lensFlares[0].style.top = `${sunY + Math.sin(angle) * 50}px`;
                lensFlares[0].style.opacity = (1 - distance/300) * 0.6;
                
                lensFlares[1].style.width = '15px';
                lensFlares[1].style.height = '80px';
                lensFlares[1].style.left = `${sunX + Math.cos(angle) * 100}px`;
                lensFlares[1].style.top = `${sunY + Math.sin(angle) * 100}px`;
                lensFlares[1].style.transform = `rotate(${angle}rad)`;
                lensFlares[1].style.opacity = (1 - distance/300) * 0.4;
                
                lensFlares[2].style.width = '10px';
                lensFlares[2].style.height = '10px';
                lensFlares[2].style.left = `${sunX + Math.cos(angle) * 150}px`;
                lensFlares[2].style.top = `${sunY + Math.sin(angle) * 150}px`;
                lensFlares[2].style.opacity = (1 - distance/300) * 0.3;
            } else {
                lensFlares.forEach(flare => flare.style.opacity = '0');
            }
        }

        // Event listeners
        function setupEventListeners() {
            timeSlider.addEventListener('input', (e) => {
                config.timeOfDay = parseFloat(e.target.value);
                updateSky();
            });
            
            cloudSlider.addEventListener('input', (e) => {
                config.cloudDensity = parseFloat(e.target.value);
                generateClouds();
            });
            
            document.addEventListener('mousemove', (e) => {
                updateLensFlare(e);
            });
            
            window.addEventListener('resize', () => {
                // Recalculate positions on resize
                updateSky();
            });
        }

        // Animation loop
        function animate() {
            // Add subtle wind speed variations
            config.windSpeed = 0.8 + Math.sin(Date.now() / 10000) * 0.4;
            
            // Update cloud animations with new wind speed
            document.querySelectorAll('.cloud').forEach(cloud => {
                const currentAnim = cloud.style.animation;
                const speedMatch = currentAnim.match(/move\w+/);
                if (speedMatch) {
                    const speedType = speedMatch[0];
                    const baseSpeed = speedType === 'moveFast' ? 0.8 : 
                                    speedType === 'moveMedium' ? 0.5 : 0.3;
                    const duration = 100 / (baseSpeed * config.windSpeed);
                    cloud.style.animation = `${speedType} ${duration}s linear infinite`;
                }
            });
            
            requestAnimationFrame(animate);
        }

        // Helper function
        function randomBetween(min, max) {
            return Math.random() * (max - min) + min;
        }

        // Start the simulation
        init();
    </script>
</body>
</html>
